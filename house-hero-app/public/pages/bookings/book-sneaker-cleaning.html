<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Sneaker Cleaning | HouseHero</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="light">
    <a href="../../index.html" class="back-btn" title="Back to Home">←</a>
    <a href="#" class="menu-icon" id="menu-toggle">☰</a>
    <button id="toggle-dark" class="dark-mode-toggle" title="Toggle Dark Mode">
      ☀️
    </button>
    <div class="bar bar-top"></div>
    <header class="cleaning-header">
      <h1 class="cleaning-title">Book Sneaker Cleaning</h1>
      <p class="subtitle">Professional sneaker restoration service</p>
    </header>
    <!-- Sidebar Menu -->
    <aside id="sidebar-menu" class="sidebar-menu">
      <button class="close-btn" id="close-menu">×</button>
      <div class="sidebar-profile">
        <img
          src="https://randomuser.me/api/portraits/men/1.jpg"
          alt="User Avatar"
          class="sidebar-avatar"
        />
        <div class="sidebar-name">Apiwe Fuzile</div>
      </div>
      <nav class="sidebar-nav">
        <a href="../../pages/dashboard/profile.html" class="sidebar-link"
          >profile</a
        >
        <a href="../../pages/dashboard/settings.html" class="sidebar-link"
          >settings</a
        >
        <a href="../../pages/services/complaints.html" class="sidebar-link"
          >complaints</a
        >
        <a href="../../pages/info/contact.html" class="sidebar-link"
          >get in touch</a
        >
        <a href="../../pages/info/faq.html" class="sidebar-link">F.A.Q</a>
        <a href="#" class="sidebar-link logout-link">⎋ logout</a>
      </nav>
    </aside>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    <main class="main-section">
      <form id="booking-form" class="booking-form">
        <div class="form-group">
          <label for="name">Full Name *</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="Enter your full name"
          />
        </div>
        <div class="form-group">
          <label for="address">Address *</label>
          <input
            type="text"
            id="address"
            name="address"
            required
            placeholder="Enter your address"
          />
          <div
            id="address-warning"
            class="warning-message"
            style="display: none"
          >
            ⚠️ We currently serve Midrand and Johannesburg areas only
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="date">Preferred Date *</label>
            <input type="date" id="date" name="date" required />
          </div>
          <div class="form-group">
            <label for="time">Preferred Time *</label>
            <select id="time" name="time" required>
              <option value="">Select time</option>
              <option value="08:00">8:00 AM</option>
              <option value="09:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
              <option value="13:00">1:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="16:00">4:00 PM</option>
              <option value="17:00">5:00 PM</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="details">Sneaker Details</label>
          <textarea
            id="details"
            name="details"
            rows="4"
            placeholder="Tell us about your sneakers (brand, model, condition, specific stains, etc.)"
          ></textarea>
        </div>
        <div class="service-info">
          <div style="font-size: 1.2em; font-weight: 600; margin-bottom: 1em">
            Price: R300 ZAR
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn login-btn">Book Now</button>
        </div>
      </form>
    </main>
    <script src="/js/config.js"></script>
    <script src="/js/script.js"></script>
    <script>
      let gmap, gmarker, autocomplete;
      function initGMap() {
        gmap = new google.maps.Map(document.getElementById("gmap"), {
          center: { lat: -25.9992, lng: 28.1266 },
          zoom: 12,
        });
        gmarker = new google.maps.Marker({ map: gmap });
        const addressInput = document.getElementById("address");
        autocomplete = new google.maps.places.Autocomplete(addressInput, {
          types: ["geocode"],
          componentRestrictions: { country: "za" },
        });
        autocomplete.addListener("place_changed", function () {
          const place = autocomplete.getPlace();
          if (!place.geometry) return;
          gmap.setCenter(place.geometry.location);
          gmarker.setPosition(place.geometry.location);
          // Show warning if not Midrand or Johannesburg, but do not disable submit
          const address = addressInput.value;
          if (
            !address.includes("Midrand") &&
            !address.includes("Johannesburg")
          ) {
            document.getElementById("address-warning").style.display = "block";
          } else {
            document.getElementById("address-warning").style.display = "none";
          }
        });
        // Also check on manual input
        addressInput.addEventListener("input", function () {
          const address = addressInput.value;
          if (
            !address.includes("Midrand") &&
            !address.includes("Johannesburg")
          ) {
            document.getElementById("address-warning").style.display = "block";
          } else {
            document.getElementById("address-warning").style.display = "none";
          }
        });
      }
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("booking-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            const booking = {
              name: document.getElementById("name").value,
              address: document.getElementById("address").value,
              date: document.getElementById("date").value,
              time: document.getElementById("time").value,
              service: "Sneaker Cleaning",
              details: document.getElementById("details").value,
              status: "pending",
            };
            console.log("Submitting booking:", booking);
            console.log("API URL:", `${API_BASE_URL}/api/bookings`);

            fetch(`${API_BASE_URL}/api/bookings`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(booking),
            })
              .then((response) => {
                console.log("Response status:", response.status);
                return response.json();
              })
              .then((data) => {
                console.log("✅ Booking response:", data);

                if (data.booking) {
                  localStorage.setItem(
                    "lastBooking",
                    JSON.stringify(data.booking)
                  );
                  console.log(
                    "✅ Saved booking to localStorage:",
                    data.booking
                  );
                  console.log("✅ Redirecting to booking-success.html");
                  window.location.href = "booking-success.html";
                } else {
                  console.error("❌ No booking data in response:", data);
                  alert("Booking failed! No booking data received.");
                }
              })
              .catch((error) => {
                console.error("❌ Booking error:", error);
                alert("Booking failed! Please try again.");
              });
          });
      });
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADPVyJOYeH7DIOD3x9jmJPmfG_LKvXzsc&libraries=places&callback=initGMap"
      async
      defer
    ></script>
  </body>
</html>
